<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HSilveira - Financial</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-dark: #0a1f1a;
            --bg-card: #1a2f2a;
            --primary-green: #4ade80;
            --primary-dark: #22c55e;
            --text-primary: #ffffff;
            --text-secondary: #94a3b8;
            --border-color: #2d4a42;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #0a1f1a 0%, #1a2f2a 100%);
            color: var(--text-primary);
            min-height: 100vh;
        }

        /* Login Page */
        .login-container {
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
        }

        .login-box {
            background: var(--bg-card);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            width: 100%;
            max-width: 400px;
            border: 1px solid var(--border-color);
        }

        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            margin-bottom: 30px;
        }

        .logo-icon {
            width: 40px;
            height: 40px;
            background: var(--primary-green);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .logo h1 {
            font-size: 24px;
            font-weight: 600;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-secondary);
            font-size: 14px;
        }

        .input-group input {
            width: 100%;
            padding: 12px 16px;
            background: var(--bg-dark);
            border: 1px solid var(--border-color);
            border-radius: 10px;
            color: var(--text-primary);
            font-size: 14px;
            transition: all 0.3s;
        }

        .input-group input:focus {
            outline: none;
            border-color: var(--primary-green);
            box-shadow: 0 0 0 3px rgba(74, 222, 128, 0.1);
        }

        .btn-primary {
            width: 100%;
            padding: 14px;
            background: var(--primary-green);
            color: var(--bg-dark);
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(74, 222, 128, 0.3);
        }

        .error-message {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            color: #fca5a5;
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 14px;
            display: none;
        }

        /* Dashboard */
        .dashboard {
            display: none;
            min-height: 100vh;
        }

        .navbar {
            background: var(--bg-card);
            padding: 20px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
        }

        .navbar .logo {
            margin: 0;
        }

        .nav-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .user-info {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .btn-logout {
            padding: 8px 20px;
            background: transparent;
            border: 1px solid var(--border-color);
            color: var(--text-primary);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-logout:hover {
            border-color: var(--primary-green);
            color: var(--primary-green);
        }

        .main-content {
            padding: 40px;
            max-width: 1400px;
            margin: 0 auto;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 10px;
        }

        .tab {
            padding: 10px 20px;
            background: transparent;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            border-radius: 8px 8px 0 0;
            transition: all 0.3s;
            font-size: 14px;
        }

        .tab.active {
            background: var(--bg-card);
            color: var(--primary-green);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: var(--bg-card);
            padding: 25px;
            border-radius: 15px;
            border: 1px solid var(--border-color);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .card-title {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .card-value {
            font-size: 32px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .card-positive {
            color: var(--primary-green);
        }

        .card-negative {
            color: #f87171;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            margin-bottom: 8px;
            color: var(--text-secondary);
            font-size: 14px;
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            padding: 12px;
            background: var(--bg-dark);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 14px;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .btn-secondary {
            padding: 12px 24px;
            background: var(--bg-dark);
            border: 1px solid var(--primary-green);
            color: var(--primary-green);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
        }

        .btn-secondary:hover {
            background: var(--primary-green);
            color: var(--bg-dark);
        }

        .table-container {
            background: var(--bg-card);
            border-radius: 15px;
            overflow: hidden;
            border: 1px solid var(--border-color);
        }

        .table {
            width: 100%;
            border-collapse: collapse;
        }

        .table th {
            background: var(--bg-dark);
            padding: 15px;
            text-align: left;
            font-size: 14px;
            color: var(--text-secondary);
            font-weight: 600;
        }

        .table td {
            padding: 15px;
            border-top: 1px solid var(--border-color);
            font-size: 14px;
        }

        .table tr:hover {
            background: rgba(74, 222, 128, 0.05);
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .status-pending {
            background: rgba(251, 191, 36, 0.2);
            color: #fbbf24;
        }

        .status-paid {
            background: rgba(74, 222, 128, 0.2);
            color: var(--primary-green);
        }

        .status-overdue {
            background: rgba(248, 113, 113, 0.2);
            color: #f87171;
        }

        .upload-area {
            border: 2px dashed var(--border-color);
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }

        .upload-area:hover {
            border-color: var(--primary-green);
            background: rgba(74, 222, 128, 0.05);
        }

        .upload-icon {
            font-size: 48px;
            margin-bottom: 15px;
            opacity: 0.5;
        }

        .btn-delete {
            padding: 6px 12px;
            background: transparent;
            border: 1px solid #f87171;
            color: #f87171;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.3s;
        }

        .btn-delete:hover {
            background: #f87171;
            color: white;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
        }

        .success-message {
            background: rgba(74, 222, 128, 0.1);
            border: 1px solid rgba(74, 222, 128, 0.3);
            color: var(--primary-green);
            padding: 12px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 14px;
            display: none;
        }

        @media (max-width: 768px) {
            .main-content {
                padding: 20px;
            }

            .navbar {
                padding: 15px 20px;
            }

            .cards-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Login Page -->
    <div id="loginPage" class="login-container">
        <div class="login-box">
            <div class="logo">
                <div class="logo-icon">üí∞</div>
                <h1>HSilveira Financial</h1>
            </div>
            <div id="errorMessage" class="error-message"></div>
            <form id="loginForm">
                <div class="input-group">
                    <label>Email</label>
                    <input type="email" id="email" required autocomplete="email">
                </div>
                <div class="input-group">
                    <label>Senha</label>
                    <input type="password" id="password" required autocomplete="current-password">
                </div>
                <button type="submit" class="btn-primary">Entrar</button>
            </form>
        </div>
    </div>

    <!-- Dashboard -->
    <div id="dashboard" class="dashboard">
        <nav class="navbar">
            <div class="logo">
                <div class="logo-icon">üí∞</div>
                <h1>HSilveira Financial</h1>
            </div>
            <div class="nav-actions">
                <span class="user-info">Bem-vindo, <strong id="userName">Usu√°rio</strong></span>
                <button class="btn-logout" onclick="logout()">Sair</button>
            </div>
        </nav>

        <div class="main-content">
            <!-- Tabs -->
            <div class="tabs">
                <button class="tab active" onclick="showTab('overview')">Vis√£o Geral</button>
                <button class="tab" onclick="showTab('transactions')">Lan√ßamentos</button>
                <button class="tab" onclick="showTab('contracts')">Contratos</button>
                <button class="tab" onclick="showTab('planning')">Planejamento</button>
                <button class="tab" onclick="showTab('documents')">Documentos</button>
                <button class="tab" onclick="showTab('settings')">Configura√ß√µes</button>
            </div>

            <!-- Overview Tab -->
            <div id="overviewTab" class="tab-content active">
                <div class="cards-grid">
                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">Saldo Total</span>
                        </div>
                        <div class="card-value" id="totalBalance">R$ 0,00</div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">Receitas do M√™s</span>
                        </div>
                        <div class="card-value card-positive" id="monthIncome">R$ 0,00</div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">Despesas do M√™s</span>
                        </div>
                        <div class="card-value card-negative" id="monthExpenses">R$ 0,00</div>
                    </div>
                </div>

                <div class="card">
                    <h3 style="margin-bottom: 20px;">Pr√≥ximos Vencimentos</h3>
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Descri√ß√£o</th>
                                    <th>Vencimento</th>
                                    <th>Valor</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="upcomingPayments">
                                <tr>
                                    <td colspan="4" class="loading">Carregando...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Transactions Tab -->
            <div id="transactionsTab" class="tab-content">
                <div class="card" style="margin-bottom: 20px;">
                    <h3 style="margin-bottom: 20px;">Novo Lan√ßamento</h3>
                    <div id="transactionSuccess" class="success-message"></div>
                    <form id="transactionForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Tipo</label>
                                <select id="transactionType" required>
                                    <option value="income">Receita</option>
                                    <option value="expense">Despesa</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label>Categoria</label>
                                <select id="transactionCategory" required>
                                    <option value="salary">Sal√°rio</option>
                                    <option value="service">Servi√ßo Prestado</option>
                                    <option value="food">Alimenta√ß√£o</option>
                                    <option value="transport">Transporte</option>
                                    <option value="housing">Moradia</option>
                                    <option value="health">Sa√∫de</option>
                                    <option value="education">Educa√ß√£o</option>
                                    <option value="entertainment">Lazer</option>
                                    <option value="other">Outros</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Descri√ß√£o</label>
                                <input type="text" id="transactionDescription" required>
                            </div>
                            <div class="form-group">
                                <label>Valor (R$)</label>
                                <input type="number" id="transactionAmount" step="0.01" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Data</label>
                                <input type="date" id="transactionDate" required>
                            </div>
                            <div class="form-group">
                                <label>Status</label>
                                <select id="transactionStatus" required>
                                    <option value="pending">Pendente</option>
                                    <option value="paid">Pago</option>
                                </select>
                            </div>
                        </div>
                        <button type="submit" class="btn-primary">Adicionar Lan√ßamento</button>
                    </form>
                </div>

                <div class="card">
                    <h3 style="margin-bottom: 20px;">Hist√≥rico de Lan√ßamentos</h3>
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Data</th>
                                    <th>Descri√ß√£o</th>
                                    <th>Categoria</th>
                                    <th>Valor</th>
                                    <th>Status</th>
                                    <th>A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="transactionHistory">
                                <tr>
                                    <td colspan="6" class="loading">Carregando...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Contracts Tab -->
            <div id="contractsTab" class="tab-content">
                <div class="card" style="margin-bottom: 20px;">
                    <h3 style="margin-bottom: 20px;">Novo Contrato de Servi√ßo</h3>
                    <div id="contractSuccess" class="success-message"></div>
                    <form id="contractForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Cliente/Empresa</label>
                                <input type="text" id="contractClient" required>
                            </div>
                            <div class="form-group">
                                <label>Valor Total (R$)</label>
                                <input type="number" id="contractAmount" step="0.01" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Data de In√≠cio</label>
                                <input type="date" id="contractStartDate" required>
                            </div>
                            <div class="form-group">
                                <label>Data de T√©rmino</label>
                                <input type="date" id="contractEndDate" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Parcelas</label>
                                <input type="number" id="contractInstallments" min="1" value="1">
                            </div>
                            <div class="form-group">
                                <label>Status</label>
                                <select id="contractStatus" required>
                                    <option value="active">Ativo</option>
                                    <option value="pending">Pendente</option>
                                    <option value="completed">Conclu√≠do</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Descri√ß√£o do Servi√ßo</label>
                            <textarea id="contractDescription" required></textarea>
                        </div>
                        <button type="submit" class="btn-primary">Criar Contrato</button>
                    </form>
                </div>

                <div class="card">
                    <h3 style="margin-bottom: 20px;">Contratos Ativos</h3>
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Cliente</th>
                                    <th>Valor</th>
                                    <th>In√≠cio</th>
                                    <th>T√©rmino</th>
                                    <th>Status</th>
                                    <th>A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody id="contractsList">
                                <tr>
                                    <td colspan="6" class="loading">Carregando...</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- Planning Tab -->
            <div id="planningTab" class="tab-content">
                <div class="card" style="margin-bottom: 20px;">
                    <h3 style="margin-bottom: 20px;">Simulador de Cen√°rios</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Receitas Mensais Previstas (R$)</label>
                            <input type="number" id="planIncome" step="0.01" value="0">
                        </div>
                        <div class="form-group">
                            <label>Despesas Mensais Previstas (R$)</label>
                            <input type="number" id="planExpenses" step="0.01" value="0">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Per√≠odo (meses)</label>
                            <input type="number" id="planMonths" min="1" max="24" value="6">
                        </div>
                        <div class="form-group">
                            <label>Saldo Inicial (R$)</label>
                            <input type="number" id="planInitialBalance" step="0.01" value="0">
                        </div>
                    </div>
                    <button class="btn-primary" onclick="calculatePlanning()">Calcular Proje√ß√£o</button>
                </div>

                <div class="cards-grid" id="planningResults" style="display: none;">
                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">Saldo Projetado</span>
                        </div>
                        <div class="card-value" id="projectedBalance">R$ 0,00</div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">Total Receitas</span>
                        </div>
                        <div class="card-value card-positive" id="projectedIncome">R$ 0,00</div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <span class="card-title">Total Despesas</span>
                        </div>
                        <div class="card-value card-negative" id="projectedExpenses">R$ 0,00</div>
                    </div>
                </div>
            </div>

            <!-- Documents Tab -->
            <div id="documentsTab" class="tab-content">
                <div class="card">
                    <h3 style="margin-bottom: 20px;">Upload de Documentos</h3>
                    <div id="documentSuccess" class="success-message"></div>
                    <div class="upload-area" onclick="document.getElementById('fileInput').click()">
                        <div class="upload-icon">üìÑ</div>
                        <p>Clique para selecionar arquivo</p>
                        <p style="color: var(--text-secondary); font-size: 12px; margin-top: 10px;">
                            Suporta: PDF, DOC, XLS, IMG
                        </p>
                    </div>
                    <input type="file" id="fileInput" style="display: none;" onchange="uploadDocument()">
                </div>
            </div>

            <!-- Settings Tab -->
            <div id="settingsTab" class="tab-content">
                <div class="card">
                    <h3 style="margin-bottom: 20px;">Configura√ß√µes Financeiras</h3>
                    <div id="settingsSuccess" class="success-message"></div>
                    <form id="settingsForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Sal√°rio Mensal (R$)</label>
                                <input type="number" id="monthlySalary" step="0.01" value="0">
                            </div>
                            <div class="form-group">
                                <label>Data de Recebimento</label>
                                <input type="number" id="salaryDay" min="1" max="31" value="5">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Limite de Adiantamento (%)</label>
                                <input type="number" id="advanceLimit" min="0" max="100" value="40">
                            </div>
                            <div class="form-group">
                                <label>Taxa de Adiantamento (%)</label>
                                <input type="number" id="advanceFee" step="0.01" min="0" value="5">
                            </div>
                        </div>
                        <button type="submit" class="btn-primary">Salvar Configura√ß√µes</button>
                    </form>
                </div>

                <div class="card" style="margin-top: 20px;">
                    <h3 style="margin-bottom: 20px;">Calculadora de Adiantamento</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Valor do Adiantamento (R$)</label>
                            <input type="number" id="advanceAmount" step="0.01" oninput="calculateAdvance()">
                        </div>
                        <div class="form-group">
                            <label>Valor a Receber</label>
                            <input type="text" id="advanceReceive" readonly style="background: var(--bg-dark);">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // API Base URL
        const API_URL = '/api';
        
        // Auth token
        let authToken = localStorage.getItem('authToken');

        // Check if already logged in
        if (authToken) {
            validateToken();
        }

        // Login Form
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;

            try {
                const response = await fetch(`${API_URL}/auth`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });

                const data = await response.json();

                if (response.ok && data.success) {
                    authToken = data.token;
                    localStorage.setItem('authToken', authToken);
                    document.getElementById('userName').textContent = data.user.name || data.user.email;
                    showDashboard();
                } else {
                    showError(data.error || 'Erro ao fazer login');
                }
            } catch (error) {
                console.error('Error:', error);
                showError('Erro de conex√£o com o servidor');
            }
        });

        async function validateToken() {
            try {
                const response = await fetch(`${API_URL}/auth/validate`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (response.ok) {
                    const data = await response.json();
                    document.getElementById('userName').textContent = data.user?.email || 'Usu√°rio';
                    showDashboard();
                } else {
                    localStorage.removeItem('authToken');
                    authToken = null;
                }
            } catch (error) {
                console.error('Erro ao validar token:', error);
            }
        }

        function showDashboard() {
            document.getElementById('loginPage').style.display = 'none';
            document.getElementById('dashboard').style.display = 'block';
            loadDashboardData();
        }

        function logout() {
            localStorage.removeItem('authToken');
            authToken = null;
            document.getElementById('loginPage').style.display = 'flex';
            document.getElementById('dashboard').style.display = 'none';
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            setTimeout(() => errorDiv.style.display = 'none', 5000);
        }

        function showSuccess(elementId, message) {
            const successDiv = document.getElementById(elementId);
            successDiv.textContent = message;
            successDiv.style.display = 'block';
            setTimeout(() => successDiv.style.display = 'none', 5000);
        }

        // Tab Management
        function showTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');
        }

        // Load Dashboard Data
        async function loadDashboardData() {
            await Promise.all([
                loadOverview(),
                loadTransactions(),
                loadContracts(),
                loadSettings()
            ]);
        }

        async function loadOverview() {
            try {
                const response = await fetch(`${API_URL}/transactions/overview`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                const data = await response.json();

                document.getElementById('totalBalance').textContent = formatCurrency(data.totalBalance);
                document.getElementById('monthIncome').textContent = formatCurrency(data.monthIncome);
                document.getElementById('monthExpenses').textContent = formatCurrency(data.monthExpenses);

                loadUpcomingPayments();
            } catch (error) {
                console.error('Erro ao carregar overview:', error);
            }
        }

        async function loadUpcomingPayments() {
            try {
                const response = await fetch(`${API_URL}/transactions/upcoming`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                const data = await response.json();

                const tbody = document.getElementById('upcomingPayments');
                if (data.transactions.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="4" style="text-align: center; color: var(--text-secondary);">Nenhum pagamento pr√≥ximo</td></tr>';
                    return;
                }

                tbody.innerHTML = data.transactions.map(t => `
                    <tr>
                        <td>${t.description}</td>
                        <td>${formatDate(t.date)}</td>
                        <td>${formatCurrency(t.amount)}</td>
                        <td><span class="status-badge status-${t.status}">${getStatusText(t.status)}</span></td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Erro ao carregar pagamentos:', error);
            }
        }

        async function loadTransactions() {
            try {
                const response = await fetch(`${API_URL}/transactions`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                const data = await response.json();

                const tbody = document.getElementById('transactionHistory');
                if (data.transactions.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: var(--text-secondary);">Nenhum lan√ßamento registrado</td></tr>';
                    return;
                }

                tbody.innerHTML = data.transactions.map(t => `
                    <tr>
                        <td>${formatDate(t.date)}</td>
                        <td>${t.description}</td>
                        <td>${getCategoryText(t.category)}</td>
                        <td style="color: ${t.type === 'income' ? 'var(--primary-green)' : '#f87171'}">${formatCurrency(t.amount)}</td>
                        <td><span class="status-badge status-${t.status}">${getStatusText(t.status)}</span></td>
                        <td><button class="btn-delete" onclick="deleteTransaction('${t._id}')">Excluir</button></td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Erro ao carregar transa√ß√µes:', error);
            }
        }

        async function loadContracts() {
            try {
                const response = await fetch(`${API_URL}/contracts`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                const data = await response.json();

                const tbody = document.getElementById('contractsList');
                if (data.contracts.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; color: var(--text-secondary);">Nenhum contrato registrado</td></tr>';
                    return;
                }

                tbody.innerHTML = data.contracts.map(c => `
                    <tr>
                        <td>${c.client}</td>
                        <td>${formatCurrency(c.amount)}</td>
                        <td>${formatDate(c.startDate)}</td>
                        <td>${formatDate(c.endDate)}</td>
                        <td><span class="status-badge status-${c.status === 'active' ? 'paid' : c.status === 'pending' ? 'pending' : 'overdue'}">${getContractStatus(c.status)}</span></td>
                        <td><button class="btn-delete" onclick="deleteContract('${c._id}')">Excluir</button></td>
                    </tr>
                `).join('');
            } catch (error) {
                console.error('Erro ao carregar contratos:', error);
            }
        }

        async function loadSettings() {
            try {
                const response = await fetch(`${API_URL}/settings`, {
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });
                const data = await response.json();

                if (data.settings) {
                    document.getElementById('monthlySalary').value = data.settings.monthlySalary || 0;
                    document.getElementById('salaryDay').value = data.settings.salaryDay || 5;
                    document.getElementById('advanceLimit').value = data.settings.advanceLimit || 40;
                    document.getElementById('advanceFee').value = data.settings.advanceFee || 5;
                }
            } catch (error) {
                console.error('Erro ao carregar configura√ß√µes:', error);
            }
        }

        // Transaction Form
        document.getElementById('transactionForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const transaction = {
                type: document.getElementById('transactionType').value,
                category: document.getElementById('transactionCategory').value,
                description: document.getElementById('transactionDescription').value,
                amount: parseFloat(document.getElementById('transactionAmount').value),
                date: document.getElementById('transactionDate').value,
                status: document.getElementById('transactionStatus').value
            };

            try {
                const response = await fetch(`${API_URL}/transactions`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(transaction)
                });

                if (response.ok) {
                    showSuccess('transactionSuccess', 'Lan√ßamento adicionado com sucesso!');
                    document.getElementById('transactionForm').reset();
                    loadTransactions();
                    loadOverview();
                }
            } catch (error) {
                console.error('Erro ao adicionar transa√ß√£o:', error);
            }
        });

        // Contract Form
        document.getElementById('contractForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const contract = {
                client: document.getElementById('contractClient').value,
                amount: parseFloat(document.getElementById('contractAmount').value),
                startDate: document.getElementById('contractStartDate').value,
                endDate: document.getElementById('contractEndDate').value,
                installments: parseInt(document.getElementById('contractInstallments').value),
                status: document.getElementById('contractStatus').value,
                description: document.getElementById('contractDescription').value
            };

            try {
                const response = await fetch(`${API_URL}/contracts`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(contract)
                });

                if (response.ok) {
                    showSuccess('contractSuccess', 'Contrato criado com sucesso!');
                    document.getElementById('contractForm').reset();
                    loadContracts();
                }
            } catch (error) {
                console.error('Erro ao criar contrato:', error);
            }
        });

        // Settings Form
        document.getElementById('settingsForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const settings = {
                monthlySalary: parseFloat(document.getElementById('monthlySalary').value),
                salaryDay: parseInt(document.getElementById('salaryDay').value),
                advanceLimit: parseFloat(document.getElementById('advanceLimit').value),
                advanceFee: parseFloat(document.getElementById('advanceFee').value)
            };

            try {
                const response = await fetch(`${API_URL}/settings`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(settings)
                });

                if (response.ok) {
                    showSuccess('settingsSuccess', 'Configura√ß√µes salvas com sucesso!');
                }
            } catch (error) {
                console.error('Erro ao salvar configura√ß√µes:', error);
            }
        });

        // Planning Calculator
        function calculatePlanning() {
            const income = parseFloat(document.getElementById('planIncome').value) || 0;
            const expenses = parseFloat(document.getElementById('planExpenses').value) || 0;
            const months = parseInt(document.getElementById('planMonths').value) || 6;
            const initialBalance = parseFloat(document.getElementById('planInitialBalance').value) || 0;

            const totalIncome = income * months;
            const totalExpenses = expenses * months;
            const projectedBalance = initialBalance + totalIncome - totalExpenses;

            document.getElementById('projectedBalance').textContent = formatCurrency(projectedBalance);
            document.getElementById('projectedBalance').className = 'card-value ' + (projectedBalance >= 0 ? 'card-positive' : 'card-negative');
            document.getElementById('projectedIncome').textContent = formatCurrency(totalIncome);
            document.getElementById('projectedExpenses').textContent = formatCurrency(totalExpenses);
            document.getElementById('planningResults').style.display = 'grid';
        }

        // Advance Calculator
        function calculateAdvance() {
            const amount = parseFloat(document.getElementById('advanceAmount').value) || 0;
            const fee = parseFloat(document.getElementById('advanceFee').value) || 5;
            const receive = amount - (amount * fee / 100);
            document.getElementById('advanceReceive').value = formatCurrency(receive);
        }

        // Document Upload
        async function uploadDocument() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            
            if (!file) return;

            const formData = new FormData();
            formData.append('file', file);

            try {
                const response = await fetch('https://vps61817.publiccloud.com.br/webhook/cadastro/files', {
                    method: 'POST',
                    body: formData
                });

                if (response.ok) {
                    showSuccess('documentSuccess', 'Documento enviado com sucesso!');
                    fileInput.value = '';
                } else {
                    alert('Erro ao enviar documento');
                }
            } catch (error) {
                console.error('Erro ao enviar documento:', error);
                alert('Erro ao enviar documento');
            }
        }

        // Delete Functions
        async function deleteTransaction(id) {
            if (!confirm('Deseja realmente excluir este lan√ßamento?')) return;

            try {
                const response = await fetch(`${API_URL}/transactions/${id}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (response.ok) {
                    loadTransactions();
                    loadOverview();
                }
            } catch (error) {
                console.error('Erro ao excluir transa√ß√£o:', error);
            }
        }

        async function deleteContract(id) {
            if (!confirm('Deseja realmente excluir este contrato?')) return;

            try {
                const response = await fetch(`${API_URL}/contracts/${id}`, {
                    method: 'DELETE',
                    headers: { 'Authorization': `Bearer ${authToken}` }
                });

                if (response.ok) {
                    loadContracts();
                }
            } catch (error) {
                console.error('Erro ao excluir contrato:', error);
            }
        }

        // Utility Functions
        function formatCurrency(value) {
            return new Intl.NumberFormat('pt-BR', {
                style: 'currency',
                currency: 'BRL'
            }).format(value);
        }

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('pt-BR');
        }

        function getStatusText(status) {
            const statuses = {
                'pending': 'Pendente',
                'paid': 'Pago',
                'overdue': 'Atrasado'
            };
            return statuses[status] || status;
        }

        function getContractStatus(status) {
            const statuses = {
                'active': 'Ativo',
                'pending': 'Pendente',
                'completed': 'Conclu√≠do'
            };
            return statuses[status] || status;
        }

        function getCategoryText(category) {
            const categories = {
                'salary': 'Sal√°rio',
                'service': 'Servi√ßo',
                'food': 'Alimenta√ß√£o',
                'transport': 'Transporte',
                'housing': 'Moradia',
                'health': 'Sa√∫de',
                'education': 'Educa√ß√£o',
                'entertainment': 'Lazer',
                'other': 'Outros'
            };
            return categories[category] || category;
        }

        // Set today's date as default
        document.getElementById('transactionDate').valueAsDate = new Date();
    </script>
</body>
</html>